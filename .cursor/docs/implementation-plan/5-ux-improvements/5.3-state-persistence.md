# 5.3 –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è

**‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 1.5 —á–∞—Å–∞

## üéØ –¶–µ–ª—å

–£–ª—É—á—à–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

## üìã –®–∞–≥–∏

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ persist –≤ Zustand

```typescript
// –û–±–Ω–æ–≤–∏—Ç—å src/store/index.ts:
export const useAppStore = create<AppState>()(
  devtools(
    persist(
      immer((set, get) => ({
        // ... state
      })),
      {
        name: "box4kids-store",
        partialize: (state) => ({
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
          user: state.user,
          currentStep: state.currentStep,
          phone: state.phone,
          name: state.name,
          childDraft: state.childDraft,
          deliveryDraft: state.deliveryDraft,
        }),
        version: 1, // –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
      }
    )
  )
);
```

### 2. –•—É–∫ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–§–∞–π–ª:** `src/hooks/useStateRestore.ts`

```typescript
import { useEffect } from "react";
import { useAppStore } from "../store";

export const useStateRestore = () => {
  const store = useAppStore();

  useEffect(() => {
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ React Query
    if (store.user) {
      // queryClient.setQueryData(queryKeys.auth.user, store.user);
    }

    // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    const lastActivity = localStorage.getItem("last_activity");
    const now = Date.now();
    const oneDay = 24 * 60 * 60 * 1000;

    if (lastActivity && now - parseInt(lastActivity) > oneDay) {
      store.reset();
      localStorage.removeItem("last_activity");
    } else {
      localStorage.setItem("last_activity", now.toString());
    }
  }, []);
};
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ App.tsx

```typescript
import { useStateRestore } from "./hooks/useStateRestore";

function App() {
  useStateRestore(); // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

  return (
    <QueryClientProvider client={queryClient}>
      <LoginPage />
    </QueryClientProvider>
  );
}
```

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ localStorage

```typescript
// –í store/index.ts –¥–æ–±–∞–≤–∏—Ç—å:
const persistConfig = {
  name: "box4kids-store",
  storage: {
    getItem: (name: string) => {
      try {
        return localStorage.getItem(name);
      } catch {
        console.warn("LocalStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
        return null;
      }
    },
    setItem: (name: string, value: string) => {
      try {
        localStorage.setItem(name, value);
      } catch {
        console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ LocalStorage");
      }
    },
    removeItem: (name: string) => {
      try {
        localStorage.removeItem(name);
      } catch {
        console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∏–∑ LocalStorage");
      }
    },
  },
};
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- [ ] Zustand persist –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
- [ ] –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–∞—é—Ç—Å—è
- [ ] –û—à–∏–±–∫–∏ localStorage –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —à–∞–≥–∏

- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π:** [5.2 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º](./5.2-form-validation.md)
- **–°–ª–µ–¥—É—é—â–∏–π:** [5.4 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](./5.4-performance.md)
