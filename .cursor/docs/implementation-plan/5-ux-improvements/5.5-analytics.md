# 5.5 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 2 —á–∞—Å–∞

## üéØ –¶–µ–ª—å

–î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞.

## üìã –®–∞–≥–∏

### 1. –°–æ–∑–¥–∞–Ω–∏–µ Analytics —Å–µ—Ä–≤–∏—Å–∞

**–§–∞–π–ª:** `src/services/analytics.ts`

```typescript
interface AnalyticsEvent {
  event: string;
  properties?: Record<string, any>;
  userId?: string;
}

class Analytics {
  private userId: string | null = null;

  setUserId(userId: string) {
    this.userId = userId;
  }

  track(event: string, properties?: Record<string, any>) {
    const eventData: AnalyticsEvent = {
      event,
      properties: {
        ...properties,
        timestamp: new Date().toISOString(),
        url: window.location.href,
      },
      userId: this.userId || undefined,
    };

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    this.sendToServer(eventData);

    // –õ–æ–≥–∏—Ä—É–µ–º –≤ development
    if (process.env.NODE_ENV === "development") {
      console.log("Analytics:", eventData);
    }
  }

  private sendToServer(eventData: AnalyticsEvent) {
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    fetch("/api/analytics", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(eventData),
    }).catch((error) => {
      console.warn("Analytics error:", error);
    });
  }
}

export const analytics = new Analytics();
```

### 2. –•—É–∫ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π

**–§–∞–π–ª:** `src/hooks/useAnalytics.ts`

```typescript
import { useEffect } from "react";
import { analytics } from "../services/analytics";
import { useCurrentUser } from "./api/useCurrentUser";

export const useAnalytics = () => {
  const { user } = useCurrentUser();

  useEffect(() => {
    if (user) {
      analytics.setUserId(user.id.toString());
    }
  }, [user]);

  return {
    trackEvent: analytics.track.bind(analytics),
    trackStepView: (step: number) => {
      analytics.track("step_viewed", { step });
    },
    trackFormSubmit: (formName: string) => {
      analytics.track("form_submitted", { form: formName });
    },
    trackError: (error: string, context?: string) => {
      analytics.track("error_occurred", { error, context });
    },
  };
};
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```typescript
import { useAnalytics } from "../hooks/useAnalytics";

export const LoginPage = () => {
  const { trackStepView, trackFormSubmit, trackError } = useAnalytics();

  useEffect(() => {
    trackStepView(currentStep);
  }, [currentStep]);

  const handleSendCode = async () => {
    try {
      const result = await sendOtp(phone);
      trackFormSubmit("send_otp");

      if (result.success) {
        setStep(Step.Code);
      } else {
        trackError("otp_send_failed", result.error?.message);
      }
    } catch (error: any) {
      trackError("otp_send_error", error.message);
    }
  };
};
```

### 4. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

```typescript
export const usePageTime = (pageName: string) => {
  const { trackEvent } = useAnalytics();

  useEffect(() => {
    const startTime = Date.now();

    return () => {
      const timeSpent = Date.now() - startTime;
      trackEvent("page_time", {
        page: pageName,
        duration: timeSpent,
      });
    };
  }, [pageName, trackEvent]);
};
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- [ ] Analytics —Å–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞–Ω
- [ ] –•—É–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –°–æ–±—ã—Ç–∏—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] –í—Ä–µ–º—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —à–∞–≥–∏

- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π:** [5.4 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](./5.4-performance.md)
- **–°–ª–µ–¥—É—é—â–∏–π:** [–≠—Ç–∞–ø 6: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞](../6-refactoring/)
