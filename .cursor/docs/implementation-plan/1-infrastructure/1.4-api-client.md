# 1.4 –°–æ–∑–¥–∞–Ω–∏–µ API –∫–ª–∏–µ–Ω—Ç–∞

**‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 1.5 —á–∞—Å–∞

## üéØ –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π API –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤—Å–µ—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É.

## üìã –®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ API –∫–ª–∏–µ–Ω—Ç–∞

**–§–∞–π–ª:** `src/services/api.ts`

```typescript
import { ApiError } from "../types/errors";

class ApiClient {
  private baseURL = process.env.REACT_APP_API_URL || "http://localhost:8000";

  private async request<T>(
    endpoint: string,
    options: RequestInit = {}
  ): Promise<T> {
    const url = `${this.baseURL}${endpoint}`;

    const config: RequestInit = {
      headers: {
        "Content-Type": "application/json",
        ...options.headers,
      },
      ...options,
    };

    try {
      const response = await fetch(url, config);

      if (!response.ok) {
        const error = await response.json().catch(() => ({}));
        throw new ApiError(
          error.detail || `HTTP Error ${response.status}`,
          response.status,
          error
        );
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –æ—Ç–≤–µ—Ç–µ
      const contentType = response.headers.get("content-type");
      if (contentType && contentType.includes("application/json")) {
        return response.json();
      }

      return {} as T;
    } catch (error) {
      if (error instanceof ApiError) {
        throw error;
      }

      // –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
      throw new ApiError(
        "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É",
        0,
        error
      );
    }
  }

  async get<T>(endpoint: string): Promise<T> {
    return this.request<T>(endpoint, { method: "GET" });
  }

  async post<T>(endpoint: string, data?: any): Promise<T> {
    return this.request<T>(endpoint, {
      method: "POST",
      body: data ? JSON.stringify(data) : undefined,
    });
  }

  async put<T>(endpoint: string, data?: any): Promise<T> {
    return this.request<T>(endpoint, {
      method: "PUT",
      body: data ? JSON.stringify(data) : undefined,
    });
  }

  async delete<T>(endpoint: string): Promise<T> {
    return this.request<T>(endpoint, { method: "DELETE" });
  }

  async patch<T>(endpoint: string, data?: any): Promise<T> {
    return this.request<T>(endpoint, {
      method: "PATCH",
      body: data ? JSON.stringify(data) : undefined,
    });
  }
}

export const apiClient = new ApiClient();
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `web/.env.local` (—Å–æ–∑–¥–∞—Ç—å –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

```env
REACT_APP_API_URL=http://localhost:8000
```

**–§–∞–π–ª:** `web/.env.production`

```env
REACT_APP_API_URL=https://api.box4kids.com
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `src/types/env.d.ts`

```typescript
declare namespace NodeJS {
  interface ProcessEnv {
    REACT_APP_API_URL: string;
  }
}
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –∫–ª–∏–µ–Ω—Ç–∞

**–§–∞–π–ª:** `src/services/__tests__/api.test.ts` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```typescript
import { apiClient } from "../api";
import { ApiError } from "../../types/errors";

// –ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–∑–∂–µ)
describe("ApiClient", () => {
  test("should handle network errors", async () => {
    // –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏
    expect(() => apiClient.get("/nonexistent")).rejects.toThrow(ApiError);
  });
});
```

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –§–∞–π–ª `api.ts` —Å–æ–∑–¥–∞–Ω —Å –±–∞–∑–æ–≤—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º
- [ ] –í—Å–µ HTTP –º–µ—Ç–æ–¥—ã (GET, POST, PUT, DELETE, PATCH) —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –¢–∏–ø—ã –¥–ª—è env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω—ã
- [ ] API –∫–ª–∏–µ–Ω—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç JSON –æ—Ç–≤–µ—Ç—ã
- [ ] –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

```typescript
// –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ API –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
private getAuthHeaders(): Record<string, string> {
  const token = localStorage.getItem('auth_token');
  return token ? { Authorization: `Bearer ${token}` } : {};
}

private async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {
  const config: RequestInit = {
    headers: {
      "Content-Type": "application/json",
      ...this.getAuthHeaders(),
      ...options.headers,
    },
    ...options,
  };
  // –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞...
}
```

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —à–∞–≥–∏

- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π:** [1.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TypeScript —Ç–∏–ø–æ–≤](./1.3-typescript-types.md)
- **–°–ª–µ–¥—É—é—â–∏–π:** [1.5 –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤](./1.5-base-services.md)
