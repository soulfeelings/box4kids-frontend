# 1.5 –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 2 —á–∞—Å–∞

## üéØ –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏: –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏.

## üìã –®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ AuthService

**–§–∞–π–ª:** `src/services/authService.ts`

```typescript
import { apiClient } from "./api";
import { SendOtpRequest, VerifyOtpRequest } from "../types/requests";
import { User } from "../types/api";

export class AuthService {
  /**
   * –û—Ç–ø—Ä–∞–≤–∫–∞ OTP –∫–æ–¥–∞ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω
   */
  async sendOtp(phoneNumber: string): Promise<{ message: string }> {
    const request: SendOtpRequest = { phone_number: phoneNumber };
    return apiClient.post("/auth/send-otp", request);
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ OTP –∫–æ–¥–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  async verifyOtp(phoneNumber: string, code: string): Promise<User> {
    const request: VerifyOtpRequest = {
      phone_number: phoneNumber,
      code: code,
    };
    return apiClient.post("/auth/verify-otp", request);
  }

  /**
   * –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –±—É–¥–µ—Ç –Ω–∞ –±–µ–∫–µ–Ω–¥–µ)
   */
  async logout(): Promise<void> {
    return apiClient.post("/auth/logout");
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
   */
  async refreshToken(refreshToken: string): Promise<{ access_token: string }> {
    return apiClient.post("/auth/refresh", { refresh_token: refreshToken });
  }
}

export const authService = new AuthService();
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ UserService

**–§–∞–π–ª:** `src/services/userService.ts`

```typescript
import { apiClient } from "./api";
import { ProfileUpdateRequest } from "../types/requests";
import { User } from "../types/api";

export class UserService {
  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  async getProfile(userId: number): Promise<User> {
    return apiClient.get(`/users/${userId}`);
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  async updateProfile(
    userId: number,
    data: ProfileUpdateRequest
  ): Promise<User> {
    return apiClient.put(`/users/${userId}/profile`, data);
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–ª—è –∞–¥–º–∏–Ω–∞)
   */
  async getUsers(): Promise<User[]> {
    return apiClient.get("/users");
  }

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –∞–¥–º–∏–Ω–∞)
   */
  async deleteUser(userId: number): Promise<void> {
    return apiClient.delete(`/users/${userId}`);
  }
}

export const userService = new UserService();
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ ChildService (–∑–∞–≥–æ—Ç–æ–≤–∫–∞)

**–§–∞–π–ª:** `src/services/childService.ts`

```typescript
import { apiClient } from "./api";
import { ChildCreateRequest } from "../types/requests";
import { Child } from "../types/api";

export class ChildService {
  /**
   * –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞
   */
  async createChild(data: ChildCreateRequest): Promise<Child> {
    return apiClient.post("/users/children", data);
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–µ–π —Ä–æ–¥–∏—Ç–µ–ª—è
   */
  async getChildren(parentId: number): Promise<Child[]> {
    return apiClient.get(`/users/${parentId}/children`);
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–±–µ–Ω–∫–∞
   */
  async updateChild(childId: string, data: Partial<Child>): Promise<Child> {
    return apiClient.put(`/children/${childId}`, data);
  }

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞
   */
  async deleteChild(childId: string): Promise<void> {
    return apiClient.delete(`/children/${childId}`);
  }
}

export const childService = new ChildService();
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞

**–§–∞–π–ª:** `src/services/index.ts`

```typescript
// –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
export { authService, AuthService } from "./authService";
export { userService, UserService } from "./userService";
export { childService, ChildService } from "./childService";
export { apiClient } from "./api";

// –¢–∏–ø—ã
export type { User, Child } from "../types/api";
export type {
  SendOtpRequest,
  VerifyOtpRequest,
  ChildCreateRequest,
  ProfileUpdateRequest,
} from "../types/requests";
```

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤

**–§–∞–π–ª:** `src/services/__tests__/authService.test.ts`

```typescript
import { authService } from "../authService";
import { apiClient } from "../api";

// Mock API client
jest.mock("../api");
const mockedApiClient = apiClient as jest.Mocked<typeof apiClient>;

describe("AuthService", () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  test("sendOtp calls correct endpoint", async () => {
    const mockResponse = { message: "OTP sent" };
    mockedApiClient.post.mockResolvedValue(mockResponse);

    const result = await authService.sendOtp("+1234567890");

    expect(mockedApiClient.post).toHaveBeenCalledWith("/auth/send-otp", {
      phone_number: "+1234567890",
    });
    expect(result).toEqual(mockResponse);
  });

  test("verifyOtp calls correct endpoint", async () => {
    const mockUser = { id: 1, phone_number: "+1234567890" };
    mockedApiClient.post.mockResolvedValue(mockUser);

    const result = await authService.verifyOtp("+1234567890", "1234");

    expect(mockedApiClient.post).toHaveBeenCalledWith("/auth/verify-otp", {
      phone_number: "+1234567890",
      code: "1234",
    });
    expect(result).toEqual(mockUser);
  });
});
```

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] `AuthService` —Å–æ–∑–¥–∞–Ω —Å –º–µ—Ç–æ–¥–∞–º–∏ sendOtp –∏ verifyOtp
- [ ] `UserService` —Å–æ–∑–¥–∞–Ω —Å –º–µ—Ç–æ–¥–∞–º–∏ –ø—Ä–æ—Ñ–∏–ª—è
- [ ] `ChildService` —Å–æ–∑–¥–∞–Ω –∫–∞–∫ –∑–∞–≥–æ—Ç–æ–≤–∫–∞
- [ ] –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- [ ] JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫ –º–µ—Ç–æ–¥–∞–º
- [ ] –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ)
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

## üí° –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö

```typescript
async sendOtp(phoneNumber: string): Promise<{ message: string }> {
  try {
    const request: SendOtpRequest = { phone_number: phoneNumber };
    return await apiClient.post("/auth/send-otp", request);
  } catch (error) {
    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ —Å–µ—Ä–≤–∏—Å–∞
    console.error('AuthService.sendOtp error:', error);
    throw error; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞–ª—å—à–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ UI
  }
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```typescript
async sendOtp(phoneNumber: string): Promise<{ message: string }> {
  if (!phoneNumber || phoneNumber.length < 7) {
    throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
  }
  // –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞...
}
```

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —à–∞–≥–∏

- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π:** [1.4 –°–æ–∑–¥–∞–Ω–∏–µ API –∫–ª–∏–µ–Ω—Ç–∞](./1.4-api-client.md)
- **–°–ª–µ–¥—É—é—â–∏–π:** [1.6 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ React Query](./1.6-react-query-setup.md)
