# 4.7 –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 1 —á–∞—Å

## üéØ –¶–µ–ª—å

–°–æ–±—Ä–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç.

## üìã –®–∞–≥–∏

### 1. –•—É–∫ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

**–§–∞–π–ª:** `src/hooks/useRegistrationSubmit.ts`

```typescript
import { useAppStore } from "../store";
import { useChildren } from "./api/useChildren";
import { useSubscriptions } from "./api/useSubscriptions";
import { useCurrentUser } from "./api/useCurrentUser";

export const useRegistrationSubmit = () => {
  const { getChildDraft, getDeliveryDraft, reset } = useAppStore();
  const { user } = useCurrentUser();
  const { createChild } = useChildren(user?.id);
  const { createSubscription } = useSubscriptions(user?.id);

  const submitRegistration = async () => {
    const childData = getChildDraft();
    const deliveryData = getDeliveryDraft();

    if (!childData || !deliveryData) {
      throw new Error("–ù–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã");
    }

    // 1. –°–æ–∑–¥–∞–µ–º —Ä–µ–±–µ–Ω–∫–∞
    const child = await createChild({
      ...childData,
      parent_id: user!.id,
    });

    // 2. –°–æ–∑–¥–∞–µ–º –ø–æ–¥–ø–∏—Å–∫—É
    const subscription = await createSubscription({
      child_id: child.id,
      plan: "base", // –∏–ª–∏ –∏–∑ —Ñ–æ—Ä–º—ã
      delivery_info: deliveryData,
    });

    // 3. –û—á–∏—â–∞–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫–∏
    reset();

    return { child, subscription };
  };

  return { submitRegistration };
};
```

### 2. –ó–∞–º–µ–Ω–∞ –≤ PaymentStep

```typescript
import { useRegistrationSubmit } from "../hooks/useRegistrationSubmit";

const { submitRegistration } = useRegistrationSubmit();

const handlePaymentSubmit = async () => {
  try {
    const result = await submitRegistration();
    setStep(Step.Success);
  } catch (error) {
    setError("–û—à–∏–±–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏");
  }
};
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- [ ] –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏–∑ –∫—ç—à–∞
- [ ] –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞ –∏ –ø–æ–¥–ø–∏—Å–∫–∏
- [ ] –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞
- [ ] –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —à–∞–≥–∏

- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π:** [4.6 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è](./4.6-state-persistence.md)
- **–°–ª–µ–¥—É—é—â–∏–π:** [4.8 –°–æ–∑–¥–∞–Ω–∏–µ SubscriptionService](./4.8-subscription-service.md)
