# 4.4 –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º –Ω–∞ React Hook Form

**‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 3 —á–∞—Å–∞

## üéØ –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ä–º—ã –¥–ª—è –¥–µ—Ç–µ–π —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —à–∞–≥–∞–º–∏.

## üìã –®–∞–≥–∏

### 1. –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –¥–∞—Ç

**–§–∞–π–ª:** `src/utils/dates.ts`

```typescript
export const calculateAge = (birthDate: string): number => {
  const today = new Date();
  const birth = new Date(birthDate);
  let age = today.getFullYear() - birth.getFullYear();
  const monthDiff = today.getMonth() - birth.getMonth();

  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
    age--;
  }

  return age;
};

export const formatDateForInput = (date: string): string => {
  return new Date(date).toISOString().split("T")[0];
};
```

### 2. –•—É–∫ –¥–ª—è form flow

**–§–∞–π–ª:** `src/hooks/useChildForm.ts`

```typescript
import { useForm } from "react-hook-form";
import { useAppStore } from "../store";
import { useChildren } from "./api/useChildren";
import { useCurrentUser } from "./api/useCurrentUser";
import { Child } from "../types/api";
import { calculateAge } from "../utils/dates";

interface ChildFormData {
  name: string;
  birthDate: string;
  gender: "male" | "female" | "";
  interests: string[];
  skills: string[];
  limitations: "none" | "has_limitations";
  comment: string;
}

export const useChildForm = () => {
  const { getChildDraft, saveChildDraft, setStep } = useAppStore();
  const { user } = useCurrentUser();
  const { createChild, isCreating } = useChildren(user?.id);

  const form = useForm<ChildFormData>({
    defaultValues: getChildDraft() || {
      name: "",
      birthDate: "",
      gender: "",
      interests: [],
      skills: [],
      limitations: "none",
      comment: "",
    },
  });

  const onSubmit = async (data: ChildFormData) => {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫
    saveChildDraft(data);

    // –°–æ–∑–¥–∞–µ–º —Ä–µ–±–µ–Ω–∫–∞ –≤ API
    const childData = {
      ...data,
      age: calculateAge(data.birthDate),
      parent_id: user!.id,
    };

    await createChild(childData);
    setStep(5); // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
  };

  return {
    form,
    onSubmit: form.handleSubmit(onSubmit),
    isSubmitting: isCreating,
  };
};
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ store

**–§–∞–π–ª:** `src/store/index.ts` (–¥–æ–±–∞–≤–∏—Ç—å –∫ AppState)

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É:
childDraft: Partial<Child> | null;
deliveryDraft: any | null;
saveChildDraft: (data: any) => void;
saveDeliveryDraft: (data: any) => void;
getChildDraft: () => any;
getDeliveryDraft: () => any;

// –î–æ–±–∞–≤–∏—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
childDraft: null,
deliveryDraft: null,
saveChildDraft: (data) => set({ childDraft: data }),
saveDeliveryDraft: (data) => set({ deliveryDraft: data }),
getChildDraft: () => get().childDraft,
getDeliveryDraft: () => get().deliveryDraft,
```

### 4. –ó–∞–º–µ–Ω–∞ handleChildSubmit –≤ LoginPage

```typescript
import { useChildForm } from "../hooks/useChildForm";

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ:
const { form, onSubmit, isSubmitting } = useChildForm();

// –ó–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:
const handleChildSubmit = onSubmit;

// –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É:
<LoadingButton onClick={handleChildSubmit} isLoading={isSubmitting}>
  –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
</LoadingButton>;
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- [ ] React Hook Form –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- [ ] –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- [ ] API –≤—ã–∑–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —à–∞–≥–∏

- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π:** [4.3 –°–æ–∑–¥–∞–Ω–∏–µ —Ö—É–∫–æ–≤ –¥–ª—è –¥–µ—Ç–µ–π](./4.3-children-hooks.md)
- **–°–ª–µ–¥—É—é—â–∏–π:** [4.5 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Zustand –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏](./4.5-zustand-navigation.md)
