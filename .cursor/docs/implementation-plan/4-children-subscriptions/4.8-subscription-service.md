# 4.8 –°–æ–∑–¥–∞–Ω–∏–µ SubscriptionService

**‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 1.5 —á–∞—Å–∞

## üéØ –¶–µ–ª—å

–î–æ–ø–æ–ª–Ω–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–æ–π.

## üìã –®–∞–≥–∏

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ SubscriptionService

```typescript
// –£–∂–µ —Å–æ–∑–¥–∞–Ω –≤ 4.2, –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã:

async getActiveSubscription(childId: string): Promise<Subscription | null> {
  const subscriptions = await this.getSubscriptionsByChild(childId);
  return subscriptions.find(s => s.status === "active") || null;
}

async pauseSubscription(id: string): Promise<Subscription> {
  return apiClient.patch(`/subscriptions/${id}/pause`);
}

async resumeSubscription(id: string): Promise<Subscription> {
  return apiClient.patch(`/subscriptions/${id}/resume`);
}
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ DeliveryService

**–§–∞–π–ª:** `src/services/deliveryService.ts`

```typescript
import { apiClient } from "./api";
import { DeliveryInfo } from "../types/api";

export class DeliveryService {
  async updateDeliveryInfo(
    subscriptionId: string,
    data: DeliveryInfo
  ): Promise<DeliveryInfo> {
    return apiClient.put(`/subscriptions/${subscriptionId}/delivery`, data);
  }

  async getDeliverySchedule(subscriptionId: string): Promise<any[]> {
    return apiClient.get(`/subscriptions/${subscriptionId}/schedule`);
  }

  async rescheduleDelivery(
    subscriptionId: string,
    newDate: string
  ): Promise<any> {
    return apiClient.patch(`/subscriptions/${subscriptionId}/reschedule`, {
      delivery_date: newDate,
    });
  }
}

export const deliveryService = new DeliveryService();
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö—É–∫–æ–≤

```typescript
// –í useSubscriptions –¥–æ–±–∞–≤–∏—Ç—å:

const pauseSubscriptionMutation = useMutation({
  mutationFn: subscriptionService.pauseSubscription,
  onSuccess: (updatedSubscription) => {
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
    queryClient.setQueryData(
      queryKeys.subscriptions.byUser(userId!),
      (old: Subscription[] = []) =>
        old.map((s) =>
          s.id === updatedSubscription.id ? updatedSubscription : s
        )
    );
  },
});

return {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã
  pauseSubscription: pauseSubscriptionMutation.mutateAsync,
  isPausing: pauseSubscriptionMutation.isPending,
};
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- [ ] SubscriptionService —Ä–∞—Å—à–∏—Ä–µ–Ω
- [ ] DeliveryService —Å–æ–∑–¥–∞–Ω
- [ ] –•—É–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —à–∞–≥–∏

- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π:** [4.7 –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö](./4.7-final-submit.md)
- **–°–ª–µ–¥—É—é—â–∏–π:** [4.9 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ flow](./4.9-testing.md)
