# 4.3 –°–æ–∑–¥–∞–Ω–∏–µ —Ö—É–∫–æ–≤ –¥–ª—è –¥–µ—Ç–µ–π

**‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 2 —á–∞—Å–∞

## üéØ –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å React Query —Ö—É–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–µ—Ç—å–º–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏.

## üìã –®–∞–≥–∏

### 1. –•—É–∫ –¥–ª—è –¥–µ—Ç–µ–π

**–§–∞–π–ª:** `src/hooks/api/useChildren.ts`

```typescript
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { childService } from "../../services/childService";
import { queryKeys } from "../../utils/queryKeys";
import { Child } from "../../types/api";
import { ChildCreateRequest } from "../../types/requests";

export const useChildren = (parentId?: number) => {
  const queryClient = useQueryClient();

  const childrenQuery = useQuery({
    queryKey: queryKeys.children.byParent(parentId!),
    queryFn: () => childService.getChildren(parentId!),
    enabled: !!parentId,
  });

  const createChildMutation = useMutation({
    mutationFn: childService.createChild,
    onSuccess: (newChild) => {
      queryClient.setQueryData(
        queryKeys.children.byParent(parentId!),
        (old: Child[] = []) => [...old, newChild]
      );
    },
  });

  return {
    children: childrenQuery.data || [],
    isLoading: childrenQuery.isLoading,
    createChild: createChildMutation.mutateAsync,
    isCreating: createChildMutation.isPending,
    error: childrenQuery.error || createChildMutation.error,
  };
};
```

### 2. –•—É–∫ –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫

**–§–∞–π–ª:** `src/hooks/api/useSubscriptions.ts`

```typescript
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { subscriptionService } from "../../services/subscriptionService";
import { queryKeys } from "../../utils/queryKeys";
import { Subscription } from "../../types/api";
import { SubscriptionCreateRequest } from "../../types/requests";

export const useSubscriptions = (userId?: number) => {
  const queryClient = useQueryClient();

  const subscriptionsQuery = useQuery({
    queryKey: queryKeys.subscriptions.byUser(userId!),
    queryFn: () => subscriptionService.getSubscriptions(userId!),
    enabled: !!userId,
  });

  const createSubscriptionMutation = useMutation({
    mutationFn: subscriptionService.createSubscription,
    onSuccess: (newSubscription) => {
      queryClient.setQueryData(
        queryKeys.subscriptions.byUser(userId!),
        (old: Subscription[] = []) => [...old, newSubscription]
      );
    },
  });

  return {
    subscriptions: subscriptionsQuery.data || [],
    isLoading: subscriptionsQuery.isLoading,
    createSubscription: createSubscriptionMutation.mutateAsync,
    isCreating: createSubscriptionMutation.isPending,
    error: subscriptionsQuery.error || createSubscriptionMutation.error,
  };
};
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ query keys

**–§–∞–π–ª:** `src/utils/queryKeys.ts`

```typescript
// –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏:
export const queryKeys = {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏
  children: {
    all: ["children"] as const,
    byParent: (parentId: number) => ["children", "parent", parentId] as const,
    detail: (childId: string) => ["children", "detail", childId] as const,
  },
  subscriptions: {
    all: ["subscriptions"] as const,
    byUser: (userId: number) => ["subscriptions", "user", userId] as const,
    byChild: (childId: string) => ["subscriptions", "child", childId] as const,
  },
} as const;
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- [ ] useChildren —Ö—É–∫ —Å–æ–∑–¥–∞–Ω
- [ ] useSubscriptions —Ö—É–∫ —Å–æ–∑–¥–∞–Ω
- [ ] Query keys –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —à–∞–≥–∏

- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π:** [4.2 –°–æ–∑–¥–∞–Ω–∏–µ ChildService](./4.2-child-service.md)
- **–°–ª–µ–¥—É—é—â–∏–π:** [4.4 –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º –Ω–∞ React Hook Form](./4.4-react-hook-form.md)
